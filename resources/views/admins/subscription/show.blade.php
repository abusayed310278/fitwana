@extends('layouts.adminApp')

@section('title', 'Subscription Details')

@section('content')
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">Subscription Details</h1>
            <p class="mb-0">View comprehensive subscription information</p>
        </div>
        <div class="btn-group">
            <a href="{{ route('subscription.edit', $subscription) }}" class="btn btn-primary">
                <i class="fas fa-edit me-2"></i>Edit Subscription
            </a>
            <a href="{{ route('subscription.index') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to List
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Subscription Overview -->
        <div class="col-lg-8">
            <!-- Basic Information -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Subscription Information</h6>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Subscription ID:</strong>
                            <p class="mb-0">{{ $subscription->stripe_id }}</p>
                        </div>
                        <div class="col-md-6">
                            <strong>Status:</strong>
                            @php
                                $statusColors = [
                                    'active' => 'success',
                                    'canceled' => 'danger',
                                    'past_due' => 'warning',
                                    'trialing' => 'info',
                                    'unpaid' => 'danger'
                                ];
                                $statusColor = $statusColors[$subscription->status] ?? 'secondary';
                            @endphp
                            <p class=\"mb-0\">\n                                <span class=\"badge bg-{{ $statusColor }} fs-6\">{{ ucfirst($subscription->status) }}</span>\n                            </p>\n                        </div>\n                    </div>\n\n                    <div class=\"row mb-3\">\n                        <div class=\"col-md-6\">\n                            <strong>Plan:</strong>\n                            <p class=\"mb-0\">{{ $subscription->plan->name }}</p>\n                            <small class=\"text-muted\">${{ $subscription->plan->price }}/{{ $subscription->plan->interval }}</small>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <strong>Created:</strong>\n                            <p class=\"mb-0\">{{ $subscription->created_at->format('l, F j, Y') }}</p>\n                            <small class=\"text-muted\">{{ $subscription->created_at->format('g:i A') }}</small>\n                        </div>\n                    </div>\n\n                    @if($subscription->trial_ends_at)\n                    <div class=\"row mb-3\">\n                        <div class=\"col-md-6\">\n                            <strong>Trial Period:</strong>\n                            <p class=\"mb-0\">\n                                @if($subscription->trial_ends_at->isFuture())\n                                    <span class=\"text-info\">Active until {{ $subscription->trial_ends_at->format('M d, Y') }}</span>\n                                @else\n                                    <span class=\"text-muted\">Ended {{ $subscription->trial_ends_at->format('M d, Y') }}</span>\n                                @endif\n                            </p>\n                        </div>\n                    </div>\n                    @endif\n\n                    @if($subscription->ends_at)\n                    <div class=\"row mb-3\">\n                        <div class=\"col-md-6\">\n                            <strong>Ends At:</strong>\n                            <p class=\"mb-0\">\n                                @if($subscription->ends_at->isFuture())\n                                    <span class=\"text-warning\">{{ $subscription->ends_at->format('M d, Y g:i A') }}</span>\n                                @else\n                                    <span class=\"text-danger\">Expired {{ $subscription->ends_at->format('M d, Y g:i A') }}</span>\n                                @endif\n                            </p>\n                        </div>\n                    </div>\n                    @endif\n                </div>\n            </div>\n\n            <!-- Customer Information -->\n            <div class=\"card shadow mb-4\">\n                <div class=\"card-header py-3\">\n                    <h6 class=\"m-0 font-weight-bold text-primary\">Customer Information</h6>\n                </div>\n                <div class=\"card-body\">\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <div class=\"d-flex align-items-center mb-3\">\n                                <div class=\"avatar-circle me-3\">\n                                    <i class=\"fas fa-user fa-lg text-primary\"></i>\n                                </div>\n                                <div>\n                                    <h6 class=\"mb-1\">{{ $subscription->user->name }}</h6>\n                                    <p class=\"mb-0 text-muted\">{{ $subscription->user->email }}</p>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <strong>Member Since:</strong>\n                            <p class=\"mb-0\">{{ $subscription->user->created_at->format('F Y') }}</p>\n                            \n                            <strong class=\"d-block mt-2\">User Role:</strong>\n                            <p class=\"mb-0\">\n                                @foreach($subscription->user->roles as $role)\n                                    <span class=\"badge bg-info\">{{ $role->name }}</span>\n                                @endforeach\n                            </p>\n                        </div>\n                    </div>\n                    \n                    <hr>\n                    \n                    <div class=\"row\">\n                        <div class=\"col-md-4\">\n                            <div class=\"text-center\">\n                                <h5 class=\"mb-0 text-primary\">{{ $subscription->user->appointments()->count() }}</h5>\n                                <small class=\"text-muted\">Total Appointments</small>\n                            </div>\n                        </div>\n                        <div class=\"col-md-4\">\n                            <div class=\"text-center\">\n                                <h5 class=\"mb-0 text-success\">{{ $subscription->user->orders()->count() }}</h5>\n                                <small class=\"text-muted\">Total Orders</small>\n                            </div>\n                        </div>\n                        <div class=\"col-md-4\">\n                            <div class=\"text-center\">\n                                <h5 class=\"mb-0 text-info\">{{ $subscription->user->subscriptions()->count() }}</h5>\n                                <small class=\"text-muted\">Subscriptions</small>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Quick Actions -->\n            <div class=\"card shadow mb-4\">\n                <div class=\"card-header py-3\">\n                    <h6 class=\"m-0 font-weight-bold text-primary\">Quick Actions</h6>\n                </div>\n                <div class=\"card-body\">\n                    <div class=\"row\">\n                        <div class=\"col-md-3 mb-2\">\n                            @if($subscription->status == 'active')\n                            <button type=\"button\" class=\"btn btn-warning btn-sm w-100\" onclick=\"pauseSubscription({{ $subscription->id }})\">\n                                <i class=\"fas fa-pause me-1\"></i>Pause\n                            </button>\n                            @else\n                            <button type=\"button\" class=\"btn btn-success btn-sm w-100\" onclick=\"activateSubscription({{ $subscription->id }})\">\n                                <i class=\"fas fa-play me-1\"></i>Activate\n                            </button>\n                            @endif\n                        </div>\n                        <div class=\"col-md-3 mb-2\">\n                            <button type=\"button\" class=\"btn btn-info btn-sm w-100\" onclick=\"sendInvoice({{ $subscription->id }})\">\n                                <i class=\"fas fa-file-invoice me-1\"></i>Invoice\n                            </button>\n                        </div>\n                        <div class=\"col-md-3 mb-2\">\n                            <a href=\"https://dashboard.stripe.com/subscriptions/{{ $subscription->stripe_id }}\" \n                               target=\"_blank\" class=\"btn btn-primary btn-sm w-100\">\n                                <i class=\"fab fa-stripe me-1\"></i>Stripe\n                            </a>\n                        </div>\n                        <div class=\"col-md-3 mb-2\">\n                            @if($subscription->status != 'canceled')\n                            <button type=\"button\" class=\"btn btn-danger btn-sm w-100\" onclick=\"cancelSubscription({{ $subscription->id }})\">\n                                <i class=\"fas fa-ban me-1\"></i>Cancel\n                            </button>\n                            @else\n                            <span class=\"btn btn-secondary btn-sm w-100 disabled\">\n                                <i class=\"fas fa-times me-1\"></i>Canceled\n                            </span>\n                            @endif\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Sidebar -->\n        <div class=\"col-lg-4\">\n            <!-- Plan Details -->\n            <div class=\"card shadow mb-4\">\n                <div class=\"card-header py-3\">\n                    <h6 class=\"m-0 font-weight-bold text-primary\">Plan Details</h6>\n                </div>\n                <div class=\"card-body text-center\">\n                    <h4 class=\"text-primary mb-2\">{{ $subscription->plan->name }}</h4>\n                    <h2 class=\"text-success mb-1\">${{ $subscription->plan->price }}</h2>\n                    <small class=\"text-muted\">per {{ $subscription->plan->interval }}</small>\n                    \n                    @if($subscription->plan->description)\n                    <hr>\n                    <p class=\"text-muted text-start\">{{ $subscription->plan->description }}</p>\n                    @endif\n                    \n                    <hr>\n                    <div class=\"text-start\">\n                        <div class=\"mb-2\">\n                            <i class=\"fas fa-check text-success me-2\"></i>\n                            <span>Full access to workouts</span>\n                        </div>\n                        <div class=\"mb-2\">\n                            <i class=\"fas fa-check text-success me-2\"></i>\n                            <span>Nutrition plans & recipes</span>\n                        </div>\n                        <div class=\"mb-2\">\n                            <i class=\"fas fa-check text-success me-2\"></i>\n                            <span>Progress tracking</span>\n                        </div>\n                        <div class=\"mb-2\">\n                            <i class=\"fas fa-check text-success me-2\"></i>\n                            <span>Coach consultations</span>\n                        </div>\n                        <div class=\"mb-2\">\n                            <i class=\"fas fa-check text-success me-2\"></i>\n                            <span>Premium content access</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Subscription Status -->\n            <div class=\"card shadow mb-4\">\n                <div class=\"card-header py-3\">\n                    <h6 class=\"m-0 font-weight-bold text-primary\">Status Timeline</h6>\n                </div>\n                <div class=\"card-body\">\n                    <div class=\"timeline\">\n                        <div class=\"timeline-item\">\n                            <div class=\"timeline-marker bg-primary\"></div>\n                            <div class=\"timeline-content\">\n                                <h6 class=\"mb-1\">Subscription Created</h6>\n                                <small class=\"text-muted\">{{ $subscription->created_at->format('M d, Y g:i A') }}</small>\n                            </div>\n                        </div>\n                        \n                        @if($subscription->trial_ends_at)\n                        <div class=\"timeline-item\">\n                            <div class=\"timeline-marker {{ $subscription->trial_ends_at->isPast() ? 'bg-secondary' : 'bg-info' }}\"></div>\n                            <div class=\"timeline-content\">\n                                <h6 class=\"mb-1\">Trial {{ $subscription->trial_ends_at->isPast() ? 'Ended' : 'Ends' }}</h6>\n                                <small class=\"text-muted\">{{ $subscription->trial_ends_at->format('M d, Y g:i A') }}</small>\n                            </div>\n                        </div>\n                        @endif\n                        \n                        @if($subscription->ends_at)\n                        <div class=\"timeline-item\">\n                            <div class=\"timeline-marker {{ $subscription->ends_at->isPast() ? 'bg-danger' : 'bg-warning' }}\"></div>\n                            <div class=\"timeline-content\">\n                                <h6 class=\"mb-1\">Subscription {{ $subscription->ends_at->isPast() ? 'Expired' : 'Expires' }}</h6>\n                                <small class=\"text-muted\">{{ $subscription->ends_at->format('M d, Y g:i A') }}</small>\n                            </div>\n                        </div>\n                        @endif\n                        \n                        <div class=\"timeline-item\">\n                            <div class=\"timeline-marker bg-{{ $statusColor }}\"></div>\n                            <div class=\"timeline-content\">\n                                <h6 class=\"mb-1\">Current Status</h6>\n                                <small class=\"text-muted\">{{ ucfirst($subscription->status) }}</small>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Related Information -->\n            <div class=\"card shadow\">\n                <div class=\"card-header py-3\">\n                    <h6 class=\"m-0 font-weight-bold text-primary\">Related Information</h6>\n                </div>\n                <div class=\"card-body\">\n                    <div class=\"mb-3\">\n                        <strong>Last Updated:</strong>\n                        <p class=\"mb-0 text-muted\">{{ $subscription->updated_at->diffForHumans() }}</p>\n                    </div>\n                    \n                    @if($subscription->user->userProfile)\n                    <div class=\"mb-3\">\n                        <strong>User Profile:</strong>\n                        <p class=\"mb-0\">\n                            <small class=\"text-muted\">\n                                Age: {{ $subscription->user->userProfile->age ?? 'N/A' }}<br>\n                                Goal: {{ $subscription->user->userProfile->fitness_goal ?? 'N/A' }}\n                            </small>\n                        </p>\n                    </div>\n                    @endif\n                    \n                    <div class=\"d-grid gap-2\">\n                        <a href=\"{{ route('staff.show', $subscription->user) }}\" class=\"btn btn-outline-primary btn-sm\">\n                            <i class=\"fas fa-user me-2\"></i>View User Profile\n                        </a>\n                        \n                        @if($subscription->user->appointments()->count() > 0)\n                        <a href=\"{{ route('appointment.index') }}?user={{ $subscription->user->id }}\" class=\"btn btn-outline-info btn-sm\">\n                            <i class=\"fas fa-calendar me-2\"></i>User Appointments\n                        </a>\n                        @endif\n                        \n                        @if($subscription->user->orders()->count() > 0)\n                        <button class=\"btn btn-outline-success btn-sm\">\n                            <i class=\"fas fa-shopping-cart me-2\"></i>Purchase History\n                        </button>\n                        @endif\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n@endsection\n\n@push('styles')\n<style>\n.avatar-circle {\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    background-color: #f8f9fc;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border: 2px solid #e3e6f0;\n}\n\n.timeline {\n    position: relative;\n    padding-left: 20px;\n}\n\n.timeline::before {\n    content: '';\n    position: absolute;\n    left: 10px;\n    top: 0;\n    bottom: 0;\n    width: 2px;\n    background: #e3e6f0;\n}\n\n.timeline-item {\n    position: relative;\n    margin-bottom: 20px;\n}\n\n.timeline-item:last-child {\n    margin-bottom: 0;\n}\n\n.timeline-marker {\n    position: absolute;\n    left: -15px;\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    border: 2px solid #fff;\n    box-shadow: 0 0 0 2px #e3e6f0;\n}\n\n.timeline-content {\n    padding-left: 15px;\n}\n</style>\n@endpush\n\n@push('scripts')\n<script>\nfunction pauseSubscription(subscriptionId) {\n    if (confirm('Are you sure you want to pause this subscription?')) {\n        // In a real implementation, this would make an API call to Stripe\n        alert('Pause subscription functionality would be integrated with Stripe API.');\n    }\n}\n\nfunction activateSubscription(subscriptionId) {\n    if (confirm('Are you sure you want to activate this subscription?')) {\n        // Redirect to edit page with active status\n        window.location.href = `{{ route('subscription.edit', $subscription) }}/${subscriptionId}?status=active`;\n    }\n}\n\nfunction cancelSubscription(subscriptionId) {\n    if (confirm('Are you sure you want to cancel this subscription? This action cannot be undone.')) {\n        // Redirect to edit page with canceled status\n        window.location.href = `{{ route('subscription.edit', $subscription) }}/${subscriptionId}?status=canceled`;\n    }\n}\n\nfunction sendInvoice(subscriptionId) {\n    if (confirm('Send invoice to customer?')) {\n        // In a real implementation, this would integrate with Stripe to send invoice\n        alert('Send invoice functionality would be integrated with Stripe API to send invoice to customer.');\n    }\n}\n</script>\n@endpush", "original_text": ""}]
